# For the win. Rogue-like game

# Описание геймплея и ключевых идей

Игрок передвигается по двухмерной карте, на которой расположены стены, враги и предметы. Игрок собирает предметы, 
чтобы повышать свои характеристики и эффективнее сражаться с врагами. Враги постоянно появляются в случайных точках карты.

На карте есть порталы, которые позволяют перейти на другую карту. 
Следующая карта будет населена более сильными врагами и более мощными предметами. Назад пройти нельзя.

Одной из особенностей игры являются фабрики предметов и мобов. Внешний вид предметов и мобов и их характеристики 
генерируются в начале игры, и не сохраняются между перезапусками (но сохраняются в рамках одной сессии). 
То есть, перед началом игры игрок не знает какими характеристиками обладают конкретные элементы на карте. Ему необходимо
с ними взаимодействовать, чтобы узнать их свойства. При этом свойства предметов станут сразу очевидными, а вот о свойствах
мобов можно будет только предполагать.

Цель игры - пройти как можно большее количество карт.

# Термины и определения

### Сессия (`Session`)
Процесс игры с первого уровня до смерти (достижения нулевого уровня здоровья) главного персонажа.

### Уровень (`Stage`)
Уровень определяет карту, противников и их характеристики; награды, которые могут быть обнаружены на карте.

### Карта (`Map`)
Двумерный массив, на котором зафиксированы положения объектов (стен, проходов на другие карты).   
Карты генерируются автоматически или подгружаются из файла.

### Юнит (`Unit`)
Объект игры, который обладает поведением и состоянием (игрок и мобы)

### Предмет (`Item`)
Объект игры, который не обладает поведением, но влияет на характеристики игрока

## Характеристики юнита
1. **Здоровье** (`HP`)
* Максимальное здоровье  
* Текущее здоровье.   
Для игрока сохраняется при переходе на следующий уровень
* Множитель здоровья (как быстро оно восстанавливается)

2. **Урон** (`Damage`) - Диапазон значений в рамках которых наносится урон противнику.
* Минимальный урон 
* Максимальный урон 

3. **Защита** (`Defence`) - Сравнивается с атакой. Результат - множитель, учитываемый при подсчете реального урона.
* Текущая защита - каждая единица защиты уменьшает входящий обратно пропорционально разнице атаки и защиты.

4. **Атака** (`Attack`) - Сравнивается с защитой. Результат - множитель, учитываемый при подсчете реального урона.
* Текущая атака - каждая единица атаки увеличивает урон на 5%.

5. **Скорость** (`Speed`)- Скорость перемещения юнита по карте
* Текущая скорость
* Множитель скорости

6. **Стратегия**
Определяет модель поведение юнита (какие действия он будет совершать)

## Игрок
Игрок - юнит, которым управляет пользователь. Стратегия - ручное управление с клавиатуры. Обладает следующими дополнительными характеристиками:   

1. **Опыт** (`XP`)
* Текущий опыт
* Множитель опыта
С достижением определенного значения опыта, увеличивается уровень игрока. Опыт обнуляется.

2. **Уровень** (`Level`) - Влияет на другие характеристики игрока
* Текущий уровень. 

3. **Требуемый опыт до следующего уровня**(`nextLevel`) - Сколько необходимо получить опыта до перехода на следующий уровень

4. **Увеличение опыта**(`nextLevelIncrease`) - Скрытая переменная, позволяющая ввести прогрессивную шкалу на получение опыта.
Прогрессия геометрическая, чтобы каждый следующий уровень было сложнее получить.


## Противники (Mobs)

Фабрика противников при старте сессии генерирует несколько видов (`Kinds`) мобов. 
Они различаются по Стратегии поведения (`Strategy`), внешнему виду (символу) и характеристикам.
Например, генератор сгенерировал моба `'A'`, который обладает значительным здоровьем и защитой,
но малой скоростью и параметрами атаки.

При старте уровня фабрика адаптирует конкретные значения параметров моба под текущий уровень и отдает их игровому движку.
Таким образом игрок может путем проб и ошибок узнать какие мобы опасные, а какие не очень. И это знание с ним сохранится
до конца сессии. Но при начале новой сессии все поменяется.

Мобы обладают автономной стратегией (`Strategy`), которая определяет вид поведения.

1. **AttackAround Strategy**
Моб наносит урон по всем клеткам вокруг, независимо от его направления движения.
2. **Confused Strategy**
Реализует эффект конфузии (стан)
3. **Invisible Strategy**
Моб невидим на большом расстоянии. При приближении становится видим.
4. **Pursuit Strategy**
Преследует игрока
5. **Bloodsucker Strategy**
Реализует поведение одноверменно и `AttackAround Strategy` и `Pursuit Strategy`
6. **Roam Strategy**
Случайные перемещения
7. **Statue Strategy**
Неподвижный моб


## Предметы (Items)

Фабрика предметов при старте сессии генерирует несколько видов (`Kinds`) предметов.
Они различаются характеристиками на которую предмет влияет и внешнему виду (символу).
Например, генератор сгенерировал предмет `'^'`, который повышает минимальный урон.

При старте уровня фабрика адаптирует конкретные значения параметров предмета под текущий уровень и отдает их игровому движку.

Предметы бывают двух видов - Loot и Consumable. Первое это обычные носимые предметы. Второе - это используемые предметы, которые применяют свой эффект и сразу исчезают

## Judge
Получает юнита, его следующее действие и карту и определяет как фактически измениться его состояние.
Если произошел контакт между игроком и мобом, то `Judge` консультируется c Боевой системой (`CombatSystem`) и изменяет текущее здоровье у игрока и моба.
По-умолчанию бой происходит если игрок захотел пойти на клетку моба, или наоборот бот захотел пойти на клетку занятую игроком.


# Технические детали
## Технологии
Игра будет написана на Java 17, собираться с помощью `Maven`. Библиотека для отрисовки терминала - `Lanterna`

## Меню
Окно с названием игры, приглашает пользователя к игре. При нажатии любой клавиши начинается игра.

## Основная логика игры
1. Отображение меню
2. Инициализация игры:  
   2.1. Создание игрока  
   2.2. Генерация типов мобов и типов предметов
3. Цикл по комнатам:  
   3.1. Сгенерировать комнату  
   3.2. Поместить игрока на карту  
   3.3. Инициализировать `Judge` и `Timeline`  
   3.4. Запуск цикла игры
4. Цикл игры:  
   4.1. Запросить у `Timeline` список юнитов, которые должны сделать действия к текущему моменту времени. 
Юнит добавляется в список ровно столько раз, столько действий он успел сделать. Порядок юнитов сохраняется.  
   4.2. Для каждого элемента из списка определить (с помощью `Judge`), как действие юнита будет отражено на карте. Обновить карту.   
   4.3. Отрисовать карту с обновленным состоянием в консоль.  

## Формат карты в файле
h и w - высота и ширина карты  
player_x и player_y - координаты игрока  
wall_cnt - количество стен  
Далее wall_cnt строк с wall_x и wall_y, координатами стен

# Диаграммы
Документы с uml-диаграммами доступны в папке src и по [ссылке](https://drive.google.com/file/d/1-Kyv6zulRddlxvYu2PO-sJDKGJtXorRm/view?usp=sharing) на diagrams.net
##  Диаграмма компонентов
![](/img/component_diagram.jpg)

## Диаграмма классов
![](/img/class_diagram.jpg)

## Сборка и запуск

Приложение поддерживает все платформы где реализована JVM. Для сборки необходим Maven 3.2+ и JDK 17+.

Для сборки и запуска
```Windows
mvn clean package
javaw -jar .\target\ftw.jar
```
```Linux
mvn clean package
java -jar ./target/ftw.jar
```
Для запуска только тестов
```
mvn clean test
```

Для анализа покрытия кода тестами
```
mvn clean test
mvn jacoco:report -f pom.xml
# Открыть в браузере файл target/site/jacoco/index.html
```
Для запуска линтера и поиска багов
```
mvn clean verify
```

# Команда разработчиков
* Бачище Ольга
* Карагодин Дмитрий
* Кузиванов Сергей
* Шушаков Даниил